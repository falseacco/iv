<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>image viewer</title>
  </head>
  <body>
		<style>
			#box {
				border: 1px solid lightgray;
				display: inline-block;
				padding: 20px 0px 5px 5px;
				margin-top: 60px;
			}
			
			#display {
				/* Take up the whole page. */
				position: absolute;
				top: 0;
				left: 0;
				height: 100%;
				width: 100%;
				background-size: auto 100%;
				/* Don't cover up anything else. */
				z-index: -1;
				/* Center the background image. */
				background-position: center;
				/* Don't use the image as a tile. */
				background-repeat: no-repeat;
			}
		</style>
		
		<div id="box">
		  <input id="upload" type="file" webkitdirectory directory multiple><br>
		  <br>
			<a id="previous" href="#/">previous</a>
			<a id="next" href="#/">next</a>
			<text id="filename"></text><br>
			<input id="file-order-chooser" type="checkbox">Display in file order
		</div>
			
		<div id="display"></div>
			
		<script type="text/javascript">
			"use strict;"
			function print(x) {
				console.log(x);
			}
		
			function $(id) {
				return document.getElementById(id);
			}
			
			function random(min, max) { // Don't use negative numbers.
			  return Math.floor((Math.random() * max) + min);
			}
		
			function d_setVisible(id, value) {
				let x = $(id);
			
				x.style.visibility = value ? 'visible' : 'hidden';
				return x.style.visibility;
			}
			
			function d_display (img) {
				let reader = new FileReader();
				reader.readAsDataURL(img);
				reader.onload = (e)=>{
					let url = e.target.result;
					
					$('display').style.backgroundImage = 'url(' + url + ')';
				};
			}
			
			{
				let upload = [],  //
				    history = [], //
						pointer = 0;  //
			
			  function d_archive(n) {
			    return history.unshift(n);
			  }
			  
			  function fetchHistory(pointer) {
			    return upload[history[pointer]];
			  }
			
				function randomIndex() {
					return random(0, upload.length);
				}
				
				function d_displayRandom() {
				  let i = randomIndex();
					d_display(upload[i]);
					return i;
				}
			
				// When a folder is uploaded, display something to start.
				$('upload').onchange = (e)=>{
					upload = Array.from($('upload').files);
					
					if (upload.length !== 0) {
						d_archive(d_displayRandom());
					};
				}
				
				$('previous').onclick = ()=>{
				  if (pointer >= 0 && pointer < (history.length - 1)) {
				    pointer += 1;
				    d_display(fetchHistory(pointer));
				  }
				}
				
				$('next').onclick = ()=>{
				  if (pointer !== 0) {
				    // Display the next image in historical order.
				    pointer -= 1;
				    d_display(fetchHistory(pointer));
				  }
				  else {
				    // Just display a random image.
				    d_archive(d_displayRandom());
				  }
				}
			}
			
			// Run the following on startup:
			print(0);
			
			// End
			
			// TODO
			// display file order wasn't stupid after all, remember to use upload[]
			// draggable box
			// arrow keys and fullscreen
			// add timer back in
		</script>
  </body>
</html>
