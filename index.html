<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>image viewer</title>
  </head>
  <body>
		<style>
		  #title {
		    z-index: -2;
		    margin: 40px 0 0 0;
		    color: rgb(100, 100, 100);
		  }
			#box {
				border: 1px solid lightgray;
				display: inline-block;
				padding: 20px 0px 5px 5px;
			}
			
			#display {
				/* Take up the whole page. */
				position: absolute;
				top: 0;
				left: 0;
				height: 100%;
				width: 100%;
				background-size: auto 100%;
				/* Don't cover up anything else, except the title sometimes. */
				z-index: -1;
				background-color: transparent;
				/* Center the background image. */
				background-position: center;
				/* Don't use the image as a tile. */
				background-repeat: no-repeat;
			}
		</style>
		
		<a href="https://www.github.com/ooorel/iv">
		  <h1 id="title">iv</h1>
		</a><br>
		
		<div id="box">
		  <input id="upload" type="file" webkitdirectory directory multiple><br>
		  <br>
			<a id="previous" href="#/" inactive>previous</a>
			<a id="next" href="#/">next</a>
			<text id="filename"></text><br>
		</div>
			
		<div id="display"></div>
			
		<script type="text/javascript">
			"use strict;"
			{
			  let testing = true;
			  
			  function print(x) {
			    if (testing) {
			      console.log(x);
			    }
			  }
			  
			  function printTest(bool) {
			    testing = bool;
			  }
			}
		
			function $(id) {
				return document.getElementById(id);
			}
			
			function random(min, max) { // Don't use negative numbers.
			  return Math.floor((Math.random() * max) + min);
			}
		
			function d_setVisible(id, value) {
				let x = $(id);
			
				x.style.visibility = value ? 'visible' : 'hidden';
				return x.style.visibility;
			}
			
			function d_display (img) {
				let reader = new FileReader();
				reader.readAsDataURL(img);
				reader.onload = (e)=>{
					let url = e.target.result;
					
					$('display').style.backgroundImage = 'url(' + url + ')';
				};
			}
			
			{
				let upload = [],  //
				    history = [], //
						pointer = 0;  //
			
			  function d_archive(i) {
			    history.unshift(i);
			    return i;
			  }
			  
			  function fetchHistory(pointer) {
			    return upload[history[pointer]];
			  }
			
				function randomIndex() {
					return random(0, upload.length);
				}
				
				function d_displayRandom() {
				  let i = randomIndex();
					d_display(upload[i]);
					return i;
				}
				
				function d_displayFilename(img) {
				  $('filename').innerHTML = img.name;
				}
			
				// When a folder is uploaded, display something to start.
				$('upload').onchange = (e)=>{
					upload = Array.from($('upload').files);
					
					if (upload.length !== 0) {
					  let img = upload[0];
						d_display(img);
						d_displayFilename(img);
						d_archive(0);
					};
					print('upload.onchange()');
					print(upload);
				}
				
				$('next').onclick = ()=>{
				  if (upload.length !== 0) { // Don't want to try to display nothing.
				    if (pointer !== 0) {
				      // Display the next image in historical order.
				      pointer -= 1;
				      let img = fetchHistory(pointer);
				      d_display(img);
				      d_displayFilename(img);
				      print('next.onclick() historical');
				    }
				    else {
				      // Just display a random image.
				      let i = d_archive(d_displayRandom());
				      d_displayFilename(upload[i]);
				      print('next.onclick() random');
				    }
				  }
				  print('next.onclick() inactive');
				}
				
				$('previous').onclick = ()=>{
				  if (pointer >= 0 && pointer < (history.length - 1)) {
				    pointer += 1;
				    let img = fetchHistory(pointer);
				    d_display(img);
				    d_displayFilename(img);
				    print('previous.onclick() active');
				  }
				  print('previous.onclick() inactive');
				}
			}
			
			// Keyboard shortcuts.
			let KEY_NEXT = 'ArrowRight',
			    KEY_PREV = 'ArrowLeft';
			    
			document.onkeydown = (e)=>{
			  e = e || window.event;
			  if (e.key === KEY_NEXT) {
			    $('next').click();
			  }
			  else if (e.key == KEY_PREV) {
			    $('previous').click();
			  }
			};
			
			// -------- Run the following on <startup>: ------------
			print('hi');
			printTest(false);
			
			// In case they're reloading the page.
			$('upload').onchange();
			
			// ---------------------- End --------------------------
			
			// TODO
			// fullscreen | https://www.w3schools.com/howto/howto_js_fullscreen.asp
			// add timer back in
		</script>
  </body>
</html>
